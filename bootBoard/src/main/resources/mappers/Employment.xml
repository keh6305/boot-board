<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bootBoard.mapper.EmploymentMapper">
    <!-- 회사 갯수 검색 -->
    <select id="searchCompanyCount" parameterType="SearchCompanyDto" resultType="int">
        SELECT COUNT(*) FROM company
        WHERE
            <![CDATA[#{min_rating} <= company_rating AND company_rating <= #{max_rating}]]>
            <if test="main_area != 0">
                AND company_main_area = #{main_area}
            </if>
            <if test="sub_area != 0">
                AND company_sub_area = #{sub_area}
            </if>
            <if test="keyword != ''">
                AND company_name LIKE CONCAT ('%', #{keyword}, '%')
            </if>
    </select>

    <!-- 회사 검색-->
    <select id="searchCompany" resultType="CompanyDto">
        SELECT
            c.company_id, c.company_name, c.company_rating, c.company_detail_area,
            a1.area AS main_area, a2.area AS sub_area
        FROM company c
        LEFT JOIN area a1 ON a1.area_id = c.company_main_area
        LEFT JOIN area a2 ON a2.area_id = c.company_sub_area
        WHERE
            <![CDATA[#{search.min_rating} <= company_rating AND company_rating <= #{search.max_rating}]]>
            <if test="search.main_area != 0">
                AND company_main_area = #{search.main_area}
            </if>
            <if test="search.sub_area != 0">
                AND company_sub_area = #{search.sub_area}
            </if>
            <if test="search.keyword != ''">
                AND company_name LIKE CONCAT ('%', #{search.keyword}, '%')
            </if>
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 메인 지역 목록 조회 -->
    <select id="selectMainAreaList" resultType="AreaDto">
        SELECT area_id, area
        FROM area
        WHERE area_parent = 0
    </select>

    <!-- 서브 지역 목록 조회 -->
    <select id="selectSubAreaList" parameterType="int" resultType="AreaDto">
        SELECT area_id, area
        FROM area
        WHERE area_parent = #{area_parent}
    </select>

    <!-- 회사 상세 조회 -->
    <select id="selectCompany" parameterType="int" resultType="CompanyDto">
        SELECT
            c.company_id, c.company_name, c.company_rating, c.company_welfare,
            c.company_main_area, c.company_sub_area, c.company_detail_area,
            c.company_create_date, c.company_modify_date,
            a1.area AS main_area, a2.area AS sub_area
        FROM company c
        LEFT JOIN area a1 ON c.company_main_area = a1.area_id
        LEFT JOIN area a2 ON c.company_sub_area = a2.area_id
        WHERE c.company_id = #{company_id}
    </select>

    <!-- 회사 등록 -->
    <insert id="insertCompany" parameterType="CompanyDto">
        INSERT INTO company
        (company_name, company_rating, company_introduce, company_welfare, company_main_area, company_sub_area, company_detail_area, company_create_date)
        VALUES
        (#{company_name}, #{company_rating}, #{company_introduce}, #{company_welfare}, #{company_main_area}, #{company_sub_area}, #{company_detail_area}, NOW())
    </insert>

    <!-- 회사 수정 -->
    <update id="updateCompany" parameterType="CompanyDto">
        UPDATE company
        SET
            company_name = #{company_name},
            company_rating = #{company_rating},
            company_introduce = #{company_introduce},
            company_welfare = #{company_welfare},
            company_main_area = #{company_main_area},
            company_sub_area = #{company_sub_area},
            company_detail_area = #{company_detail_area},
            company_modify_date = NOW()
        WHERE company_id = #{company_id}
    </update>

    <!-- 기술 목록 조회 -->
    <select id="selectTechList" resultType="TechDto">
        SELECT tech_id, tech
        FROM tech
    </select>
</mapper>